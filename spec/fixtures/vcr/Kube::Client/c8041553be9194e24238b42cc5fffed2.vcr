HTTP/1.1 200 OK
Content-Type: application/json
Date: Wed, 10 Apr 2019 17:40:37 GMT
Connection: close
Transfer-Encoding: chunked
Content-Length: 26774

{"kind":"PodList","apiVersion":"v1","metadata":{"selfLink":"/api/v1/namespaces/default/pods","resourceVersion":"486825"},"items":[{"metadata":{"name":"mysqlha-9497j","generateName":"mysqlha-","namespace":"default","selfLink":"/api/v1/namespaces/default/pods/mysqlha-9497j","uid":"01e6fd95-5bb5-11e9-bf08-00505683ad44","resourceVersion":"484655","creationTimestamp":"2019-04-10T17:20:59Z","labels":{"app":"mysqlha","app.kubernetes.io/component":"database","app.kubernetes.io/instance":"mysqlha","app.kubernetes.io/managed-by":"Tiller","app.kubernetes.io/name":"mysqlha","app.kubernetes.io/part-of":"optanix-platform","app.kubernetes.io/version":"5.7.25","chart":"mysqlha-0.1.0","component":"server","controller-revision-hash":"3205749636","helm.sh/chart":"mysqlha-0.1.0","heritage":"Tiller","pod-template-generation":"1","release":"mysqlha"},"annotations":{"cni.projectcalico.org/podIP":"10.42.2.55/32"},"ownerReferences":[{"apiVersion":"apps/v1","kind":"DaemonSet","name":"mysqlha","uid":"018f22fe-5bb5-11e9-afcc-005056831f87","controller":true,"blockOwnerDeletion":true}]},"spec":{"volumes":[{"name":"data","hostPath":{"path":"/var/lib/mysql","type":""}},{"name":"conf","hostPath":{"path":"/etc/mysql/conf.d","type":""}},{"name":"config-map","configMap":{"name":"mysqlha","defaultMode":420}},{"name":"scripts","configMap":{"name":"mysqlha-scripts","defaultMode":420}},{"name":"default-token-gwws6","secret":{"secretName":"default-token-gwws6","defaultMode":420}}],"initContainers":[{"name":"consul-registry","image":"consul:1.3.1","command":["/bin/sh"],"args":["-c","source /mnt/scripts/mysqlha_lib.sh;\n\ncheck_if_slave\n\n# If host is a slave and the master is dead, will register as new master\nif [ ${i_am_the_highlander} == 0 ] \u0026\u0026 [ ${master_alive} == 0 ]; then\n  echo \"I am a slave AND master is dead\"\n  echo \"Long live the new master: ${HOSTNAME}\"\n  register_as_master\nfi\n"],"env":[{"name":"CONSUL_DC","value":"optx"},{"name":"CONSUL_HTTP_ADDR","value":"consul-server.default.svc.cluster.local:8500"},{"name":"CONSUL_HTTP_SSL_VERIFY","value":"false"}],"resources":{},"volumeMounts":[{"name":"conf","mountPath":"/mnt/conf.d"},{"name":"config-map","mountPath":"/mnt/config-map"},{"name":"scripts","mountPath":"/mnt/scripts"},{"name":"default-token-gwws6","readOnly":true,"mountPath":"/var/run/secrets/kubernetes.io/serviceaccount"}],"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"IfNotPresent"},{"name":"init-mysql","image":"consul:1.3.1","command":["/bin/sh"],"args":["-c","set -ex\n# Copy all cnf files\ncp -f /mnt/config-map/* /mnt/conf.d/\n\n# Copy server-id.conf adding offset to avoid reserved server-id=0 value.\ncat /mnt/config-map/server-id.cnf | sed s/@@SERVER_ID@@/1/g \u003e /mnt/conf.d/server-id.cnf\n\n# TODO: Determine master/slave. Will remove slave for now\nrm /mnt/conf.d/slave.cnf\n\n# # Copy appropriate conf.d files from config-map to config mount.\n# if [[ $ordinal -eq 0 ]]; then\n#   cp -f /mnt/config-map/master.cnf /mnt/conf.d/\n# else\n#   cp -f /mnt/config-map/slave.cnf /mnt/conf.d/\n# fi\n#\n# # Copy replication user script\n# if [[ $ordinal -eq 0 ]]; then\n#   cp -f /mnt/config-map/create-replication-user.sh /mnt/scripts/create-replication-user.sh\n#   chmod 700 /mnt/scripts/create-replication-user.sh\n# fi\n\n# Set user to 999 (percona mysql user)\nchown -R 999:999 /mnt/conf.d /mnt/data\n"],"resources":{},"volumeMounts":[{"name":"conf","mountPath":"/mnt/conf.d"},{"name":"config-map","mountPath":"/mnt/config-map"},{"name":"scripts","mountPath":"/mnt/scripts"},{"name":"data","mountPath":"/mnt/data"},{"name":"default-token-gwws6","readOnly":true,"mountPath":"/var/run/secrets/kubernetes.io/serviceaccount"}],"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"IfNotPresent"}],"containers":[{"name":"mysql","image":"percona:5.7.25","ports":[{"name":"mysql","containerPort":3306,"protocol":"TCP"}],"env":[{"name":"MYSQL_DATABASE"},{"name":"MYSQL_ROOT_PASSWORD","valueFrom":{"secretKeyRef":{"name":"mysqlha","key":"mysql-root-password"}}},{"name":"MYSQL_REPLICATION_USER","value":"repl"},{"name":"MYSQL_REPLICATION_PASSWORD","valueFrom":{"secretKeyRef":{"name":"mysqlha","key":"mysql-replication-password"}}},{"name":"MYSQL_USER","value":"optanix"},{"name":"MYSQL_PASSWORD","valueFrom":{"secretKeyRef":{"name":"mysqlha","key":"mysql-password"}}}],"resources":{"requests":{"cpu":"100m","memory":"128Mi"}},"volumeMounts":[{"name":"data","mountPath":"/var/lib/mysql"},{"name":"conf","mountPath":"/etc/my.cnf.d"},{"name":"scripts","mountPath":"/mnt/scripts"},{"name":"default-token-gwws6","readOnly":true,"mountPath":"/var/run/secrets/kubernetes.io/serviceaccount"}],"livenessProbe":{"exec":{"command":["/bin/sh","-c","mysqladmin ping -h 127.0.0.1 -u root -p\"${MYSQL_ROOT_PASSWORD}\""]},"initialDelaySeconds":30,"timeoutSeconds":5,"periodSeconds":10,"successThreshold":1,"failureThreshold":3},"readinessProbe":{"exec":{"command":["/bin/sh","-c","mysql -h 127.0.0.1 -u root -p\"${MYSQL_ROOT_PASSWORD}\" -e \"SELECT 1\""]},"initialDelaySeconds":10,"timeoutSeconds":1,"periodSeconds":10,"successThreshold":1,"failureThreshold":3},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"IfNotPresent"}],"restartPolicy":"Always","terminationGracePeriodSeconds":30,"dnsPolicy":"ClusterFirst","serviceAccountName":"default","serviceAccount":"default","nodeName":"172.16.30.195","securityContext":{},"schedulerName":"default-scheduler","tolerations":[{"key":"node.kubernetes.io/not-ready","operator":"Exists","effect":"NoExecute"},{"key":"node.kubernetes.io/unreachable","operator":"Exists","effect":"NoExecute"},{"key":"node.kubernetes.io/disk-pressure","operator":"Exists","effect":"NoSchedule"},{"key":"node.kubernetes.io/memory-pressure","operator":"Exists","effect":"NoSchedule"},{"key":"node.kubernetes.io/unschedulable","operator":"Exists","effect":"NoSchedule"}],"priority":0},"status":{"phase":"Running","conditions":[{"type":"Initialized","status":"True","lastProbeTime":null,"lastTransitionTime":"2019-04-10T17:21:07Z"},{"type":"Ready","status":"True","lastProbeTime":null,"lastTransitionTime":"2019-04-10T17:21:29Z"},{"type":"ContainersReady","status":"True","lastProbeTime":null,"lastTransitionTime":null},{"type":"PodScheduled","status":"True","lastProbeTime":null,"lastTransitionTime":"2019-04-10T17:20:58Z"}],"hostIP":"172.16.30.195","podIP":"10.42.2.55","startTime":"2019-04-10T17:20:58Z","initContainerStatuses":[{"name":"consul-registry","state":{"terminated":{"exitCode":0,"reason":"Completed","startedAt":"2019-04-10T17:20:59Z","finishedAt":"2019-04-10T17:21:05Z","containerID":"docker://3fa4fa6381805b15de995047961d8b052734990fa957de4a14a18f3c3f40b873"}},"lastState":{},"ready":true,"restartCount":0,"image":"consul:1.3.1","imageID":"docker-pullable://consul@sha256:a633ef291439c1d86bf822cfa208f4b6484dfd8518189ed8b4a0b59c4ba96903","containerID":"docker://3fa4fa6381805b15de995047961d8b052734990fa957de4a14a18f3c3f40b873"},{"name":"init-mysql","state":{"terminated":{"exitCode":0,"reason":"Completed","startedAt":"2019-04-10T17:21:07Z","finishedAt":"2019-04-10T17:21:07Z","containerID":"docker://4bb813b00d021c729a75a0ba324ad86d51f6514c0d9bb0413abda8873e89056c"}},"lastState":{},"ready":true,"restartCount":0,"image":"consul:1.3.1","imageID":"docker-pullable://consul@sha256:a633ef291439c1d86bf822cfa208f4b6484dfd8518189ed8b4a0b59c4ba96903","containerID":"docker://4bb813b00d021c729a75a0ba324ad86d51f6514c0d9bb0413abda8873e89056c"}],"containerStatuses":[{"name":"mysql","state":{"running":{"startedAt":"2019-04-10T17:21:08Z"}},"lastState":{},"ready":true,"restartCount":0,"image":"percona:5.7.25","imageID":"docker-pullable://percona@sha256:3a5b2e2f52b444ac4449e469b957348a8953b5b372bd15e1c740eb5e8c01177b","containerID":"docker://96e61bfd9d20b6157c37d66cc2ac44059cedecdaaf8046103537b16be1436a30"}],"qosClass":"Burstable"}},{"metadata":{"name":"mysqlha-helper-55f7c4dc96-8rcjd","generateName":"mysqlha-helper-55f7c4dc96-","namespace":"default","selfLink":"/api/v1/namespaces/default/pods/mysqlha-helper-55f7c4dc96-8rcjd","uid":"020849da-5bb5-11e9-bf08-00505683ad44","resourceVersion":"484499","creationTimestamp":"2019-04-10T17:20:59Z","labels":{"app":"mysqlha","app.kubernetes.io/component":"database","app.kubernetes.io/instance":"mysqlha","app.kubernetes.io/managed-by":"Tiller","app.kubernetes.io/name":"mysqlha","app.kubernetes.io/part-of":"optanix-platform","app.kubernetes.io/version":"5.7.25","chart":"mysqlha-0.1.0","component":"helper","helm.sh/chart":"mysqlha-0.1.0","heritage":"Tiller","pod-template-hash":"1193708752","release":"mysqlha"},"annotations":{"cni.projectcalico.org/podIP":"10.42.1.47/32"},"ownerReferences":[{"apiVersion":"apps/v1","kind":"ReplicaSet","name":"mysqlha-helper-55f7c4dc96","uid":"01e03c57-5bb5-11e9-bf08-00505683ad44","controller":true,"blockOwnerDeletion":true}]},"spec":{"volumes":[{"name":"mysqlha-helper-token-2wgms","secret":{"secretName":"mysqlha-helper-token-2wgms","defaultMode":420}}],"containers":[{"name":"mysqlha-helper","image":"consul:1.3.1","env":[{"name":"CONSUL_DC","value":"optx"},{"name":"CONSUL_HTTP_ADDR","value":"consul-server.default.svc.cluster.local:8500"},{"name":"CONSUL_HTTP_SSL_VERIFY","value":"false"},{"name":"POD_HELM_APP","value":"mysqlha"},{"name":"POD_HELM_CHART","value":"mysqlha-0.1.0"},{"name":"POD_HELM_RELEASE","value":"mysqlha"},{"name":"POD_HELM_HERITAGE","value":"Tiller"}],"resources":{},"volumeMounts":[{"name":"mysqlha-helper-token-2wgms","readOnly":true,"mountPath":"/var/run/secrets/kubernetes.io/serviceaccount"}],"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"IfNotPresent"}],"restartPolicy":"Always","terminationGracePeriodSeconds":30,"dnsPolicy":"ClusterFirst","serviceAccountName":"mysqlha-helper","serviceAccount":"mysqlha-helper","nodeName":"172.16.30.198","securityContext":{},"schedulerName":"default-scheduler","tolerations":[{"key":"node.kubernetes.io/not-ready","operator":"Exists","effect":"NoExecute","tolerationSeconds":300},{"key":"node.kubernetes.io/unreachable","operator":"Exists","effect":"NoExecute","tolerationSeconds":300}],"priority":0},"status":{"phase":"Running","conditions":[{"type":"Initialized","status":"True","lastProbeTime":null,"lastTransitionTime":"2019-04-10T17:20:59Z"},{"type":"Ready","status":"True","lastProbeTime":null,"lastTransitionTime":"2019-04-10T17:21:00Z"},{"type":"ContainersReady","status":"True","lastProbeTime":null,"lastTransitionTime":null},{"type":"PodScheduled","status":"True","lastProbeTime":null,"lastTransitionTime":"2019-04-10T17:20:59Z"}],"hostIP":"172.16.30.198","podIP":"10.42.1.47","startTime":"2019-04-10T17:20:59Z","containerStatuses":[{"name":"mysqlha-helper","state":{"running":{"startedAt":"2019-04-10T17:21:00Z"}},"lastState":{},"ready":true,"restartCount":0,"image":"consul:1.3.1","imageID":"docker-pullable://consul@sha256:a633ef291439c1d86bf822cfa208f4b6484dfd8518189ed8b4a0b59c4ba96903","containerID":"docker://b78b6ded74e30c2b6d5f577bc347db69c72eb5ef5d93a2642c65bb71c507c910"}],"qosClass":"BestEffort"}},{"metadata":{"name":"mysqlha-tmn6x","generateName":"mysqlha-","namespace":"default","selfLink":"/api/v1/namespaces/default/pods/mysqlha-tmn6x","uid":"01e08e6a-5bb5-11e9-bf08-00505683ad44","resourceVersion":"484650","creationTimestamp":"2019-04-10T17:20:59Z","labels":{"app":"mysqlha","app.kubernetes.io/component":"database","app.kubernetes.io/instance":"mysqlha","app.kubernetes.io/managed-by":"Tiller","app.kubernetes.io/name":"mysqlha","app.kubernetes.io/part-of":"optanix-platform","app.kubernetes.io/version":"5.7.25","chart":"mysqlha-0.1.0","component":"server","controller-revision-hash":"3205749636","helm.sh/chart":"mysqlha-0.1.0","heritage":"Tiller","pod-template-generation":"1","release":"mysqlha"},"annotations":{"cni.projectcalico.org/podIP":"10.42.0.48/32"},"ownerReferences":[{"apiVersion":"apps/v1","kind":"DaemonSet","name":"mysqlha","uid":"018f22fe-5bb5-11e9-afcc-005056831f87","controller":true,"blockOwnerDeletion":true}]},"spec":{"volumes":[{"name":"data","hostPath":{"path":"/var/lib/mysql","type":""}},{"name":"conf","hostPath":{"path":"/etc/mysql/conf.d","type":""}},{"name":"config-map","configMap":{"name":"mysqlha","defaultMode":420}},{"name":"scripts","configMap":{"name":"mysqlha-scripts","defaultMode":420}},{"name":"default-token-gwws6","secret":{"secretName":"default-token-gwws6","defaultMode":420}}],"initContainers":[{"name":"consul-registry","image":"consul:1.3.1","command":["/bin/sh"],"args":["-c","source /mnt/scripts/mysqlha_lib.sh;\n\ncheck_if_slave\n\n# If host is a slave and the master is dead, will register as new master\nif [ ${i_am_the_highlander} == 0 ] \u0026\u0026 [ ${master_alive} == 0 ]; then\n  echo \"I am a slave AND master is dead\"\n  echo \"Long live the new master: ${HOSTNAME}\"\n  register_as_master\nfi\n"],"env":[{"name":"CONSUL_DC","value":"optx"},{"name":"CONSUL_HTTP_ADDR","value":"consul-server.default.svc.cluster.local:8500"},{"name":"CONSUL_HTTP_SSL_VERIFY","value":"false"}],"resources":{},"volumeMounts":[{"name":"conf","mountPath":"/mnt/conf.d"},{"name":"config-map","mountPath":"/mnt/config-map"},{"name":"scripts","mountPath":"/mnt/scripts"},{"name":"default-token-gwws6","readOnly":true,"mountPath":"/var/run/secrets/kubernetes.io/serviceaccount"}],"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"IfNotPresent"},{"name":"init-mysql","image":"consul:1.3.1","command":["/bin/sh"],"args":["-c","set -ex\n# Copy all cnf files\ncp -f /mnt/config-map/* /mnt/conf.d/\n\n# Copy server-id.conf adding offset to avoid reserved server-id=0 value.\ncat /mnt/config-map/server-id.cnf | sed s/@@SERVER_ID@@/1/g \u003e /mnt/conf.d/server-id.cnf\n\n# TODO: Determine master/slave. Will remove slave for now\nrm /mnt/conf.d/slave.cnf\n\n# # Copy appropriate conf.d files from config-map to config mount.\n# if [[ $ordinal -eq 0 ]]; then\n#   cp -f /mnt/config-map/master.cnf /mnt/conf.d/\n# else\n#   cp -f /mnt/config-map/slave.cnf /mnt/conf.d/\n# fi\n#\n# # Copy replication user script\n# if [[ $ordinal -eq 0 ]]; then\n#   cp -f /mnt/config-map/create-replication-user.sh /mnt/scripts/create-replication-user.sh\n#   chmod 700 /mnt/scripts/create-replication-user.sh\n# fi\n\n# Set user to 999 (percona mysql user)\nchown -R 999:999 /mnt/conf.d /mnt/data\n"],"resources":{},"volumeMounts":[{"name":"conf","mountPath":"/mnt/conf.d"},{"name":"config-map","mountPath":"/mnt/config-map"},{"name":"scripts","mountPath":"/mnt/scripts"},{"name":"data","mountPath":"/mnt/data"},{"name":"default-token-gwws6","readOnly":true,"mountPath":"/var/run/secrets/kubernetes.io/serviceaccount"}],"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"IfNotPresent"}],"containers":[{"name":"mysql","image":"percona:5.7.25","ports":[{"name":"mysql","containerPort":3306,"protocol":"TCP"}],"env":[{"name":"MYSQL_DATABASE"},{"name":"MYSQL_ROOT_PASSWORD","valueFrom":{"secretKeyRef":{"name":"mysqlha","key":"mysql-root-password"}}},{"name":"MYSQL_REPLICATION_USER","value":"repl"},{"name":"MYSQL_REPLICATION_PASSWORD","valueFrom":{"secretKeyRef":{"name":"mysqlha","key":"mysql-replication-password"}}},{"name":"MYSQL_USER","value":"optanix"},{"name":"MYSQL_PASSWORD","valueFrom":{"secretKeyRef":{"name":"mysqlha","key":"mysql-password"}}}],"resources":{"requests":{"cpu":"100m","memory":"128Mi"}},"volumeMounts":[{"name":"data","mountPath":"/var/lib/mysql"},{"name":"conf","mountPath":"/etc/my.cnf.d"},{"name":"scripts","mountPath":"/mnt/scripts"},{"name":"default-token-gwws6","readOnly":true,"mountPath":"/var/run/secrets/kubernetes.io/serviceaccount"}],"livenessProbe":{"exec":{"command":["/bin/sh","-c","mysqladmin ping -h 127.0.0.1 -u root -p\"${MYSQL_ROOT_PASSWORD}\""]},"initialDelaySeconds":30,"timeoutSeconds":5,"periodSeconds":10,"successThreshold":1,"failureThreshold":3},"readinessProbe":{"exec":{"command":["/bin/sh","-c","mysql -h 127.0.0.1 -u root -p\"${MYSQL_ROOT_PASSWORD}\" -e \"SELECT 1\""]},"initialDelaySeconds":10,"timeoutSeconds":1,"periodSeconds":10,"successThreshold":1,"failureThreshold":3},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"IfNotPresent"}],"restartPolicy":"Always","terminationGracePeriodSeconds":30,"dnsPolicy":"ClusterFirst","serviceAccountName":"default","serviceAccount":"default","nodeName":"172.16.30.192","securityContext":{},"schedulerName":"default-scheduler","tolerations":[{"key":"node.kubernetes.io/not-ready","operator":"Exists","effect":"NoExecute"},{"key":"node.kubernetes.io/unreachable","operator":"Exists","effect":"NoExecute"},{"key":"node.kubernetes.io/disk-pressure","operator":"Exists","effect":"NoSchedule"},{"key":"node.kubernetes.io/memory-pressure","operator":"Exists","effect":"NoSchedule"},{"key":"node.kubernetes.io/unschedulable","operator":"Exists","effect":"NoSchedule"}],"priority":0},"status":{"phase":"Running","conditions":[{"type":"Initialized","status":"True","lastProbeTime":null,"lastTransitionTime":"2019-04-10T17:21:08Z"},{"type":"Ready","status":"True","lastProbeTime":null,"lastTransitionTime":"2019-04-10T17:21:28Z"},{"type":"ContainersReady","status":"True","lastProbeTime":null,"lastTransitionTime":null},{"type":"PodScheduled","status":"True","lastProbeTime":null,"lastTransitionTime":"2019-04-10T17:20:59Z"}],"hostIP":"172.16.30.192","podIP":"10.42.0.48","startTime":"2019-04-10T17:20:59Z","initContainerStatuses":[{"name":"consul-registry","state":{"terminated":{"exitCode":0,"reason":"Completed","startedAt":"2019-04-10T17:21:00Z","finishedAt":"2019-04-10T17:21:06Z","containerID":"docker://22ead4a4f01c49638083ee7a95e07b3494e4f42c21c8f71ca0c30ffae703536d"}},"lastState":{},"ready":true,"restartCount":0,"image":"consul:1.3.1","imageID":"docker-pullable://consul@sha256:a633ef291439c1d86bf822cfa208f4b6484dfd8518189ed8b4a0b59c4ba96903","containerID":"docker://22ead4a4f01c49638083ee7a95e07b3494e4f42c21c8f71ca0c30ffae703536d"},{"name":"init-mysql","state":{"terminated":{"exitCode":0,"reason":"Completed","startedAt":"2019-04-10T17:21:08Z","finishedAt":"2019-04-10T17:21:08Z","containerID":"docker://a249a4379d6f3a279ba6dbf4ea29bc5b550856a81b3bb934d60c40ebf6c08f03"}},"lastState":{},"ready":true,"restartCount":0,"image":"consul:1.3.1","imageID":"docker-pullable://consul@sha256:a633ef291439c1d86bf822cfa208f4b6484dfd8518189ed8b4a0b59c4ba96903","containerID":"docker://a249a4379d6f3a279ba6dbf4ea29bc5b550856a81b3bb934d60c40ebf6c08f03"}],"containerStatuses":[{"name":"mysql","state":{"running":{"startedAt":"2019-04-10T17:21:09Z"}},"lastState":{},"ready":true,"restartCount":0,"image":"percona:5.7.25","imageID":"docker-pullable://percona@sha256:3a5b2e2f52b444ac4449e469b957348a8953b5b372bd15e1c740eb5e8c01177b","containerID":"docker://85cb844b939aa810db813eb05c8b731c06b0e97fc7d7639b599d13446b262daa"}],"qosClass":"Burstable"}},{"metadata":{"name":"mysqlha-vdtq5","generateName":"mysqlha-","namespace":"default","selfLink":"/api/v1/namespaces/default/pods/mysqlha-vdtq5","uid":"01e90566-5bb5-11e9-bf08-00505683ad44","resourceVersion":"484639","creationTimestamp":"2019-04-10T17:20:59Z","labels":{"app":"mysqlha","app.kubernetes.io/component":"database","app.kubernetes.io/instance":"mysqlha","app.kubernetes.io/managed-by":"Tiller","app.kubernetes.io/name":"mysqlha","app.kubernetes.io/part-of":"optanix-platform","app.kubernetes.io/version":"5.7.25","chart":"mysqlha-0.1.0","component":"server","controller-revision-hash":"3205749636","helm.sh/chart":"mysqlha-0.1.0","heritage":"Tiller","pod-template-generation":"1","release":"mysqlha"},"annotations":{"cni.projectcalico.org/podIP":"10.42.1.46/32"},"ownerReferences":[{"apiVersion":"apps/v1","kind":"DaemonSet","name":"mysqlha","uid":"018f22fe-5bb5-11e9-afcc-005056831f87","controller":true,"blockOwnerDeletion":true}]},"spec":{"volumes":[{"name":"data","hostPath":{"path":"/var/lib/mysql","type":""}},{"name":"conf","hostPath":{"path":"/etc/mysql/conf.d","type":""}},{"name":"config-map","configMap":{"name":"mysqlha","defaultMode":420}},{"name":"scripts","configMap":{"name":"mysqlha-scripts","defaultMode":420}},{"name":"default-token-gwws6","secret":{"secretName":"default-token-gwws6","defaultMode":420}}],"initContainers":[{"name":"consul-registry","image":"consul:1.3.1","command":["/bin/sh"],"args":["-c","source /mnt/scripts/mysqlha_lib.sh;\n\ncheck_if_slave\n\n# If host is a slave and the master is dead, will register as new master\nif [ ${i_am_the_highlander} == 0 ] \u0026\u0026 [ ${master_alive} == 0 ]; then\n  echo \"I am a slave AND master is dead\"\n  echo \"Long live the new master: ${HOSTNAME}\"\n  register_as_master\nfi\n"],"env":[{"name":"CONSUL_DC","value":"optx"},{"name":"CONSUL_HTTP_ADDR","value":"consul-server.default.svc.cluster.local:8500"},{"name":"CONSUL_HTTP_SSL_VERIFY","value":"false"}],"resources":{},"volumeMounts":[{"name":"conf","mountPath":"/mnt/conf.d"},{"name":"config-map","mountPath":"/mnt/config-map"},{"name":"scripts","mountPath":"/mnt/scripts"},{"name":"default-token-gwws6","readOnly":true,"mountPath":"/var/run/secrets/kubernetes.io/serviceaccount"}],"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"IfNotPresent"},{"name":"init-mysql","image":"consul:1.3.1","command":["/bin/sh"],"args":["-c","set -ex\n# Copy all cnf files\ncp -f /mnt/config-map/* /mnt/conf.d/\n\n# Copy server-id.conf adding offset to avoid reserved server-id=0 value.\ncat /mnt/config-map/server-id.cnf | sed s/@@SERVER_ID@@/1/g \u003e /mnt/conf.d/server-id.cnf\n\n# TODO: Determine master/slave. Will remove slave for now\nrm /mnt/conf.d/slave.cnf\n\n# # Copy appropriate conf.d files from config-map to config mount.\n# if [[ $ordinal -eq 0 ]]; then\n#   cp -f /mnt/config-map/master.cnf /mnt/conf.d/\n# else\n#   cp -f /mnt/config-map/slave.cnf /mnt/conf.d/\n# fi\n#\n# # Copy replication user script\n# if [[ $ordinal -eq 0 ]]; then\n#   cp -f /mnt/config-map/create-replication-user.sh /mnt/scripts/create-replication-user.sh\n#   chmod 700 /mnt/scripts/create-replication-user.sh\n# fi\n\n# Set user to 999 (percona mysql user)\nchown -R 999:999 /mnt/conf.d /mnt/data\n"],"resources":{},"volumeMounts":[{"name":"conf","mountPath":"/mnt/conf.d"},{"name":"config-map","mountPath":"/mnt/config-map"},{"name":"scripts","mountPath":"/mnt/scripts"},{"name":"data","mountPath":"/mnt/data"},{"name":"default-token-gwws6","readOnly":true,"mountPath":"/var/run/secrets/kubernetes.io/serviceaccount"}],"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"IfNotPresent"}],"containers":[{"name":"mysql","image":"percona:5.7.25","ports":[{"name":"mysql","containerPort":3306,"protocol":"TCP"}],"env":[{"name":"MYSQL_DATABASE"},{"name":"MYSQL_ROOT_PASSWORD","valueFrom":{"secretKeyRef":{"name":"mysqlha","key":"mysql-root-password"}}},{"name":"MYSQL_REPLICATION_USER","value":"repl"},{"name":"MYSQL_REPLICATION_PASSWORD","valueFrom":{"secretKeyRef":{"name":"mysqlha","key":"mysql-replication-password"}}},{"name":"MYSQL_USER","value":"optanix"},{"name":"MYSQL_PASSWORD","valueFrom":{"secretKeyRef":{"name":"mysqlha","key":"mysql-password"}}}],"resources":{"requests":{"cpu":"100m","memory":"128Mi"}},"volumeMounts":[{"name":"data","mountPath":"/var/lib/mysql"},{"name":"conf","mountPath":"/etc/my.cnf.d"},{"name":"scripts","mountPath":"/mnt/scripts"},{"name":"default-token-gwws6","readOnly":true,"mountPath":"/var/run/secrets/kubernetes.io/serviceaccount"}],"livenessProbe":{"exec":{"command":["/bin/sh","-c","mysqladmin ping -h 127.0.0.1 -u root -p\"${MYSQL_ROOT_PASSWORD}\""]},"initialDelaySeconds":30,"timeoutSeconds":5,"periodSeconds":10,"successThreshold":1,"failureThreshold":3},"readinessProbe":{"exec":{"command":["/bin/sh","-c","mysql -h 127.0.0.1 -u root -p\"${MYSQL_ROOT_PASSWORD}\" -e \"SELECT 1\""]},"initialDelaySeconds":10,"timeoutSeconds":1,"periodSeconds":10,"successThreshold":1,"failureThreshold":3},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"IfNotPresent"}],"restartPolicy":"Always","terminationGracePeriodSeconds":30,"dnsPolicy":"ClusterFirst","serviceAccountName":"default","serviceAccount":"default","nodeName":"172.16.30.198","securityContext":{},"schedulerName":"default-scheduler","tolerations":[{"key":"node.kubernetes.io/not-ready","operator":"Exists","effect":"NoExecute"},{"key":"node.kubernetes.io/unreachable","operator":"Exists","effect":"NoExecute"},{"key":"node.kubernetes.io/disk-pressure","operator":"Exists","effect":"NoSchedule"},{"key":"node.kubernetes.io/memory-pressure","operator":"Exists","effect":"NoSchedule"},{"key":"node.kubernetes.io/unschedulable","operator":"Exists","effect":"NoSchedule"}],"priority":0},"status":{"phase":"Running","conditions":[{"type":"Initialized","status":"True","lastProbeTime":null,"lastTransitionTime":"2019-04-10T17:21:07Z"},{"type":"Ready","status":"True","lastProbeTime":null,"lastTransitionTime":"2019-04-10T17:21:24Z"},{"type":"ContainersReady","status":"True","lastProbeTime":null,"lastTransitionTime":null},{"type":"PodScheduled","status":"True","lastProbeTime":null,"lastTransitionTime":"2019-04-10T17:20:58Z"}],"hostIP":"172.16.30.198","podIP":"10.42.1.46","startTime":"2019-04-10T17:20:58Z","initContainerStatuses":[{"name":"consul-registry","state":{"terminated":{"exitCode":0,"reason":"Completed","startedAt":"2019-04-10T17:21:00Z","finishedAt":"2019-04-10T17:21:05Z","containerID":"docker://f0b9ff6d2644254d79a6ca715ffc6c0bcb8d49c86c948e53a2322fce1aae5423"}},"lastState":{},"ready":true,"restartCount":0,"image":"consul:1.3.1","imageID":"docker-pullable://consul@sha256:a633ef291439c1d86bf822cfa208f4b6484dfd8518189ed8b4a0b59c4ba96903","containerID":"docker://f0b9ff6d2644254d79a6ca715ffc6c0bcb8d49c86c948e53a2322fce1aae5423"},{"name":"init-mysql","state":{"terminated":{"exitCode":0,"reason":"Completed","startedAt":"2019-04-10T17:21:06Z","finishedAt":"2019-04-10T17:21:06Z","containerID":"docker://35f90fd647c67162a3c1d95356cbc52ad22ed2abd150aa46c0eae53fb3645763"}},"lastState":{},"ready":true,"restartCount":0,"image":"consul:1.3.1","imageID":"docker-pullable://consul@sha256:a633ef291439c1d86bf822cfa208f4b6484dfd8518189ed8b4a0b59c4ba96903","containerID":"docker://35f90fd647c67162a3c1d95356cbc52ad22ed2abd150aa46c0eae53fb3645763"}],"containerStatuses":[{"name":"mysql","state":{"running":{"startedAt":"2019-04-10T17:21:07Z"}},"lastState":{},"ready":true,"restartCount":0,"image":"percona:5.7.25","imageID":"docker-pullable://percona@sha256:3a5b2e2f52b444ac4449e469b957348a8953b5b372bd15e1c740eb5e8c01177b","containerID":"docker://4cc5626b05419b78d4e3605d31b00601712bb4c27bb97c15c6eb5c1310ba9875"}],"qosClass":"Burstable"}}]}
